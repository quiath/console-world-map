
function gety(py){return int(-sin(py/90*3.1415927/2)*H/2+H/2);}
function getx(px,py){return int(sin((x+t)/90*3.1415927/2)*W/4*cos(py/90*3.1415927/2)+W/2);}
function globe(t,w,nw) {
  
  #system("tput clear");
  system("tput cup 0 0");
  system("tput setaf 2");

  split("", wm);

  i=1;
  st=1;
  while(i<=nw) {
   if (st) {
     st=0;
     py=0+w[i];
     px=0+w[i+1];
     on=1;
     i+=2;
   } else {
     st=1;
     s=w[i];
     slen=length(s);
     j=1;
     while(j<=slen){
      tok=substr(s,j,1);
      if(tok=="S"){len=0+substr(s,j+1,3); j+=4;}
      else if (tok=="T"){len=0+substr(s,j+1,2); j+=3;}
      else {len=0+tok;j++;}
      if (on) {
        for(x=px;x<px+len;++x){
          shifted=(x+180+t)%360;
          if (shifted<90||shifted>270)continue;
          wy=gety(py);#int(-sin(py/90*3.1415927/2)*H/2+H/2);
          #wy=int(H-(py+LAT)/LAT2*H);
          wx=getx(px,py);#int(sin((x+t)/90*3.1415927/2)*W/4*cos(py/90*3.1415927/2)+W/2);
          #wx=int(((x+180+t)%360)/360*W);
          wm[wy " " wx] = ":";
          #print py, px, wy, wx;
        }
      }
      px+=len;
      on=1-on;
     }
     i++;
     
   }
  }


  n=split("KEF 64.0 -22.6 YQX 48.9 -54.6 YVR 49.2 -123.2 YYC 51.1 -114.0 YYZ 43.7 -79.6 LOS 6.6 3.3 TUN 36.9 10.2 BRU 50.9 4.5 FRA 50.0 8.6 DUS 51.3 6.8 MUC 48.4 11.8 TXL 52.6 13.3 HEL 60.3 25.0 MAN 53.4 -2.3 LGW 51.1 -0.2 LHR 51.5 -0.5 STN 51.9 0.2 AMS 52.3 4.8 DUB 53.4 -6.3 CPH 55.6 12.7 OSL 60.1 11.1 KRK 50.1 19.8 ARN 59.7 17.9 JNB -26.1 28.2 LAD -8.9 13.2 LPA 27.9 -15.4 CMN 33.4 -7.6 ADD 9.0 38.8 CAI 30.1 31.4 BCN 41.3 2.1 MAD 40.5 -3.6 CDG 49.0 2.5 ORY 48.7 2.4 CTA 37.5 15.1 MXP 45.6 8.7 FCO 41.8 12.2 MLA 35.9 14.5 VIE 48.1 16.6 LIS 38.8 -9.1 ZRH 47.5 8.5 AYT 36.9 30.8 MEX 19.4 -99.1 APW -13.8 -172.0 AKL -37.0 174.8 JED 21.7 39.2 RUH 25.0 46.7 DXB 25.3 55.4 GUM 13.5 144.8 TPE 25.1 121.2 NRT 35.8 140.4 CTS 42.8 141.7 FUK 33.6 130.5 HND 35.6 139.8 CJU 33.5 126.5 GMP 37.6 126.8 MNL 14.5 121.0 AEP -34.6 -58.4 USH -54.8 -68.3 BSB -15.9 -47.9 GIG -22.8 -43.3 GRU -23.4 -46.5 CGH -23.6 -46.7 SCL -33.4 -70.8 IPC -27.2 -109.4 BOG 4.7 -74.1 LIM -12.0 -77.1 MVD -34.8 -56.0 CCS 10.6 -67.0 VVO 43.4 132.1 IEV 50.4 30.5 LED 59.8 30.3 SVO 56.0 37.4 KZN 55.6 49.3 BOM 19.1 72.9 CMB 7.2 79.9 HKG 22.3 113.9 DEL 28.6 77.1 BLR 13.2 77.7 UPG -5.1 119.6 CGK -6.1 106.7 KUL 2.7 101.7 SIN 1.4 104.0 BNE -27.4 153.1 MEL -37.7 144.8 PER -31.9 116.0 SYD -33.9 151.2 PEK 40.1 116.6 CAN 23.4 113.3 SZX 22.6 113.8 KMG 25.1 102.9 XMN 24.5 118.1 HGH 30.2 120.4 SHA 31.2 121.3 CTU 30.6 103.9 PVG 31.1 121.8 BOS 42.4 -71.0 PHX 33.4 -112.0 SFO 37.6 -122.4 LAX 33.9 -118.4 EWR 40.7 -74.2 DCA 38.9 -77.0 FLL 26.1 -80.2 SLC 40.8 -112.0 IAH 30.0 -95.3 MIA 25.8 -80.3 SEA 47.4 -122.3 DTW 42.2 -83.4 TPA 28.0 -82.5 DFW 32.9 -97.0 ATL 33.6 -84.4 LGA 40.8 -73.9 IAD 38.9 -77.5 HNL 21.3 -157.9 SAN 32.7 -117.2 MDW 41.8 -87.8 DEN 39.9 -104.7 PHL 39.9 -75.2 ANC 61.2 -150.0 JFK 40.6 -73.8 ORD 42.0 -87.9 BWI 39.2 -76.7 MSP 44.9 -93.2 CLT 35.2 -80.9 LAS 36.1 -115.2 MCO 28.4 -81.3 BKK 13.7 100.7 ICN 37.5 126.5 ATH 37.9 23.9 EZE -34.8 -58.5 PMI 39.6 2.7 DRW -12.4 130.9 DME 55.4 37.9 NBO -1.3 36.9 DOH 25.3 51.6 HLE -16.0 -5.6 DSS 14.7 -17.1 IST 41.3 28.8",a);


  split("", m);
   
  for (i=1;i<=n;i += 3) {
    x=a[i+2];
    y=a[i+1];
    shifted=(x+180+t)%360;
    if (shifted<90||shifted>270)continue;
    py=gety(y);
    px=getx(x,y);

    #py=int(H-(a[i+1]+LAT)/LAT2*H);
    #px=int(((a[i+2]+180+t)%360)/360*W);
    m[py " " px] = a[i];
    #printf(" %s %d %d",a[i], py, px);
  }
  i=0;

#  while (i<W*H-1) {
#    x=i%W; y=int(i/W);
#    k=y " " x;
#    if(k in m) {
#      printf("%s", m[k]);
#      i+=3;
#    } else {
#      printf(" ");
#      i+=1;
#    }
#  }
  
  e="";
  while (i<W*H-1) {
    x=i%W; y=int(i/W);
    k=y " " x;
    if(k in m) {
      e = e "\033[37m" m[k] "\033[32m";
      i+=3;
    } else {
      if (k in wm) { e = e ":" ;} else { e = e " ";}
      i+=1;
    }
  }
  printf("%s", e);


}

BEGIN {
  N=N?N:360;

  nw=split("75 -112 662231T13T21T38T765T26T26T25724 74 -124 8T223T35T36T754T28T24 73 -124 712626225231414T21T33T754T131T10T4215 72 -125 52T1013446T16T19T32T754T13421141T47T11T10 71 -179 1T213T3115T13844T17T19T2713T46112T253T1061T571T2141T211 70 -162 T20T112129T172115661T11T13T32T43T10T3751T86T111 69 -164 T271T1946325214113459T16T26T43T19T245342T9429 68 -179 2T12T50764217255128T12T21T48T25424T231S105 67 -179 6T10T828T10T10T20T47T28312T252S105 66 -178 92T81T126249T17T13225T27T226S139 65 -176 46T79135T12T14T12T189T25T1049213S139 64 -160 T71331287T14T11T186T26T112T141S141 63 -164 T74T19412T148T50T113S158 62 -165 T72T13116T237T48T124S1412T11 61 -165 T141T56T178T216T48T124S1353229 60 -166 11T12136T48T17841T70T13425S12574 59 -162 9T15T44T16933T694176S1199263 58 -157 3T20T42T15T15T572T1558S116T175 57 -158 221T20T44T13T15T554T112245S117T187 56 -160 2T26T45T11T16T552T122137S116T187 55 -163 1T32T484T20T51114T101218S115T206 54 -133 21T483T22T48342951S12312T155 53 -129 T483T23T463254S139T132 52 -127 T463T23T462273S139T132 51 -127 T6912T5151S13921 50 -128 31T5892T56S14022 49 -125 21T542265T52S14212 48 -124 11T5767T48S14421 47 -124 T6192T50T401S10032 46 -123 T6022T58T32313T115T84 45 -123 T5623T61T141T16422T104T8551 44 -124 T5532T63T10133T13T1183T8564 43 -124 T54T61T13734T10T1374T801174 42 -124 T55T60T1351244862674T7892 41 -124 T52T6498144282T205T75T111 40 -124 T50T65T10816133112T234T6626T122 39 -123 T48T669T171333T234T6482T122 38 -122 T46T688T134532T234T6564T111 37 -122 T46T68115721331615T233T694374 36 -121 T46T76T10T26T846365 35 -120 T44T70T17T142612T847247 34 -118 T41T70T18T25T85T10411 33 -117 T38T71T20T24T859211 32 -116 T36T71T2545T10T8791 31 -116 21T32T72T2738121T89 30 -115 12T234112T72T582T71 29 -114 11T17T132T70T592T71 28 -114 21T15T142T68T471T133T70 27 -114 22T13T152T67T472T14421T64 26 -112 12T12T161T66T492T147T62 25 -112 22T11T191T63T493T1432T10T53 24 -110 12T10T82T513T19T10T5031 23 -110 139T143T64T523T21T10T4741 22 -105 8T13133T61T533T20T10T211T22 21 -105 87483T58T552T19T1211T155T1521 20 -105 963T103T58T543T17T15T146T1431 19 -104 854T153T53T544T16T15T129T1232 18 -102 T14T11192T49T553T15T17T10T11T12T142 17 -100 T12T72T554T12T199T12T13T132 16 -97 21621T69T563T10T217T1412T11T112 15 -92 9T66T5828T246T17T11T121 14 -91 8T67T5825T266T18T11T113 13 -87 4T67T5912T296T18T11T11121 12 -86 3T11111T53T6071T244T19137T151 11 -85 287T53T5944T244T19145T13112 10 -85 28T13T48T65T263T19152T12131 9 -83 1231T16T47T64T26212T17151T12171 8 -81 12T19T46T64T292T172T224 7 -77 T19T47T61T302T181T242 6 -77 T2021T44T123T44T522T14171 5 -77 T25T434227T43T47233T114 4 -77 T26T60T39T49223T104 3 -77 T27T60T37T5122295 2 -78 T28T60T36T5331276 1 -79 T30T59T35T544792161 0 -80 T30T60T33T574682171 -1 -80 T34T55T34T58368211184 -2 -80 T36T54T32T5946632T11223 -3 -80 T41T50T30T6154624622217 -4 -81 T43T50T28T633914111T1011T1081 -5 -81 T45T48T28T642T14121T14861 -6 -81 T46T48T26T672T3191241 -7 -79 T45T47T27T676T26991 -8 -79 T45T48T26T714T23623T101 -9 -78 T43T48T27T77172T14332T121 -10 -78 T43T49T26T80131T233 -11 -77 T40T51T27 -12 -77 T40T51T27T9221152 -13 -76 T38T51T2881T81652 -14 -76 T38T51T2873T7612662 -15 -75 T37T51T2873T74T1164T211 -16 -74 T36T50T2954T75T1344 -17 -72 T33T51T2765T73T1634 -18 -70 T31T51T2585T73T24T311 -19 -70 T31T52T2395T72T25 -20 -70 T30T53T22T104T71T29 -21 -70 T30T54T2285T68T33T151 -22 -70 T29T56T2185T66T35T161 -23 -70 T27T58T2184T66T37 -24 -70 T24T61T2184T66T38 -25 -70 T23T62T19T112T67T39 -26 -70 T22T63T18T81T40 -27 -70 T22T64T17T81T40 -28 -71 T23T64T17T82T39 -29 -71 T22T66T15T83T39 -30 -71 T21T68T13T84T39 -31 -71 T21T68T13T85T38 -32 -71 T20T70T11T86T134T20 -33 -71 T19T719T889T10T17 -34 -71 T18T724T934T1611T14 -35 -72 T15S1742T20T12T221 -36 -72 T15S197T11T231 -37 -73 T17S196T10T251 -38 -73 T16S198412T274 -39 -73 T11S2374 -40 -73 T11S2372 -41 -73 812S207112T244 -42 -74 T10S2103T233 -43 -74 118S2102T233 -44 -73 8S2344 -45 -74 9S2334 -46 -74 7S2344 -47 -74 8 -48 -75 T10 -49 -75 8S1362 -50 -75 7 -51 -75 6 -52 -75 77111 -53 -73 5 -54 -73 6 -55 -71 411 -64 -60 2 -65 -63 1 -66 -65 3S1154T46291T201 -67 -67 3S1158T292T11T174T24 -68 -67 2S111T23T12T67 -69 -68 5T9725T299T77 -70 -71 216T70151249T395T86 -71 -71 316T64T664T96 -72 -102 411T22616T50T803S100 -73 -103 591T208T46S185 -74 -121 251T11T41T46S183 -75 -139 T31323T37T46S183",w);
  for (t=0;t<N;++t) {
  #for (t=0;t<1;++t) {
    globe(t,w,nw);
    system("sleep 0.1");
  }
  
}
